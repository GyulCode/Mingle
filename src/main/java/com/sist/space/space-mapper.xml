<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.sist.space.SpaceMapper">
	<select id="spaceListByCategory" resultType="SpaceVO" parameterType="hashmap">
	    SELECT space_id, category, poster, title, price, max_guest, num
	    FROM (
	        SELECT space_id, category, poster, title, price, max_guest, rownum as num
	        FROM (
	            SELECT /*+INDEX_DESC(space_list PK_SPACE_LIST)*/ 
	                sl.space_id, sl.category, sl.poster, sl.title, sl.price, sl.max_guest,
	                (SELECT COUNT(*) FROM SPACE_review sr WHERE sr.space_id = sl.space_id) as cnt_rate
	            FROM space_list sl
	            <if test="category!='all'">
	              WHERE sl.category=#{category}
	            </if>
	            ORDER BY cnt_rate DESC
	        )
	    )
	    WHERE num BETWEEN #{start} AND #{end}
	</select>

   <select id="spaceTotalpage" resultType="int" parameterType="String">
     SELECT CEIL(COUNT(*)/12.0) FROM space_list
     <if test="category!='all'">
       WHERE category=#{category}
     </if>
   </select>
 </mapper>
